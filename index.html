<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caffeinated Tutor ‚Äî Math Solver</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- math libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script src="https://unpkg.com/algebrite"></script>

  <!-- MathJax for nice math rendering -->
  <script>
    window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] }, svg: { fontCache: 'global' } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    :root{
      --p1:#ffd7e7; --p2:#e8ddff; --p3:#fff2cc; --p4:#ffe6cc; --p5:#e9ffef;
      --card: rgba(255,255,255,.85);
      --radius: 16px;
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg,var(--p5),var(--p2),var(--p1));
      min-height:100vh;
      margin:0;
    }
    .container{max-width:1100px;margin:28px auto;padding:20px;background:var(--card);border-radius:22px;box-shadow:0 14px 40px rgba(0,0,0,0.08)}
    .section{border-radius:14px;padding:16px;margin-bottom:18px;box-shadow:0 6px 18px rgba(0,0,0,0.03);background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.8))}
    .io{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(250,250,255,0.9));border-radius:12px;padding:12px}
    input, select, textarea{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:14px}
    .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .small{font-size:13px;color:#555}
    pre {white-space:pre-wrap;word-wrap:break-word}
    .icon {width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;border-radius:10px}
    @media(max-width:900px){ .io{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
  <div class="container">
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-4">
        <div style="width:58px;height:58px;border-radius:14px;background:linear-gradient(135deg,var(--p1),var(--p3));display:flex;align-items:center;justify-content:center;font-weight:800">‚òï</div>
        <div>
          <h1 style="margin:0;font-size:22px">Caffeinated Tutor</h1>
          <div class="small">Made by <strong>Syeda Manahil</strong></div>
        </div>
      </div>
      <div class="small">Cute pastel math cafe ‚Äî answers + manual steps</div>
    </header>

    <!-- Differentiation (advanced) -->
    <section class="section" id="diffSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">üî∫ Differentiation (symbolic)</h2>
        <div class="small">Supports higher-order and definite derivatives</div>
      </div>

      <div class="io">
        <div style="flex:1" class="card">
          <label class="small">Expression (in variable x):</label>
          <input id="diffExpr" placeholder="e.g. sin(x)^2 + x^3" style="width:100%" />
          <div class="mt-2 flex gap-2 items-center">
            <input id="diffOrder" placeholder="order (default 1)" style="width:140px" />
            <input id="diffAt" placeholder="Evaluate at (optional) e.g. pi/2" style="width:160px" />
            <button class="btn" style="background:linear-gradient(90deg,var(--p2),var(--p1))" onclick="doDifferentiate()">Differentiate</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Answer</strong></div>
          <div id="diffAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="diffSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Integration (advanced) -->
    <section class="section" id="intSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">‚à´ Integration (indefinite & definite)</h2>
        <div class="small">Enter integrand and optionally limits a,b (for definite integrals)</div>
      </div>

      <div class="io">
        <div style="flex:1" class="card">
          <label class="small">Integrand (variable x):</label>
          <input id="intExpr" placeholder="e.g. x^2 * e^(x)" style="width:100%" />
          <div class="mt-2 flex gap-2 items-center">
            <input id="intA" placeholder="lower limit (leave blank for indefinite)" style="width:160px" />
            <input id="intB" placeholder="upper limit (leave blank for indefinite)" style="width:160px" />
            <button class="btn" style="background:linear-gradient(90deg,var(--p5),var(--p4))" onclick="doIntegrate()">Integrate</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Answer</strong></div>
          <div id="intAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="intSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Quadratic (robust) -->
    <section class="section" id="quadSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">üü£ Quadratic (all cases)</h2>
        <div class="small">Handles real, repeated, and complex roots; shows formula steps</div>
      </div>

      <div class="io">
        <div class="card" style="flex:1">
          <label class="small">Either provide coefficients a,b,c OR full expression:</label>
          <div class="mt-2 flex gap-2">
            <input id="qa" placeholder="a" style="width:70px" />
            <input id="qb" placeholder="b" style="width:70px" />
            <input id="qc" placeholder="c" style="width:70px" />
            <input id="qexpr" placeholder="or full expression like x^2-5x+6" style="flex:1" />
            <button class="btn" onclick="doQuadratic()">Solve</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Roots</strong></div>
          <div id="quadAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="quadSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Partial Fractions -->
    <section class="section" id="pfSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">üç∞ Partial Fractions</h2>
        <div class="small">Rational decomposition (show factorization and apart())</div>
      </div>

      <div class="io">
        <div class="card" style="flex:1">
          <label class="small">Rational expression (in x):</label>
          <input id="pfExpr" placeholder="(x^2+1)/(x^3-x)" style="width:100%" />
          <div class="mt-2"><button class="btn" onclick="doPartial()">Decompose</button></div>
        </div>
        <div style="width:360px" class="card">
          <div><strong>Decomposition</strong></div>
          <div id="pfAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="pfSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Geometry (many shapes) -->
    <section class="section" id="geoSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">üî∫ Geometry (many shapes)</h2>
        <div class="small">Circle, rectangle, square, triangle, trapezoid, parallelogram, ellipse</div>
      </div>

      <div class="io">
        <div class="card" style="flex:1">
          <label class="small">Choose shape</label>
          <select id="geoShape" style="width:100%">
            <option value="circle">Circle (r)</option>
            <option value="rectangle">Rectangle (l,w)</option>
            <option value="square">Square (side)</option>
            <option value="triangle">Triangle (base,height) or (a,b,c)</option>
            <option value="trapezoid">Trapezoid (a,b,height)</option>
            <option value="parallelogram">Parallelogram (base,height)</option>
            <option value="ellipse">Ellipse (a,b)</option>
          </select>

          <div id="geoInputs" class="mt-3 space-y-2">
            <!-- dynamic inputs inserted here -->
          </div>

          <div class="mt-2">
            <button class="btn" onclick="computeGeometry()">Compute</button>
            <button class="btn" onclick="fillGeoExample()" style="background:linear-gradient(90deg,var(--p2),var(--p1));margin-left:8px">Example</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Result</strong></div>
          <div id="geoAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="geoSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Work problems (comprehensive) -->
    <section class="section" id="workSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">‚è≥ Work & Time Problems</h2>
        <div class="small">Single, combined, inverse, unknown rate problems</div>
      </div>

      <div class="io">
        <div class="card" style="flex:1">
          <label class="small">Describe problem (we accept formats):</label>
          <textarea id="workText" placeholder="Examples:
- A does job in 3 days, B in 6 days -> together?
- A finishes alone in 5 days; A+B finish in 3 days -> find B's time
- Worker rates: A:2 units/day; B:3 units/day; total work 10 units -> time?" style="width:100%;min-height:110px"></textarea>
          <div class="mt-2">
            <button class="btn" onclick="solveWork()">Solve</button>
            <button class="btn" onclick="workExample()" style="background:linear-gradient(90deg,var(--p4),var(--p3));margin-left:8px">Example</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Answer</strong></div>
          <div id="workAnswer" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps</strong></div>
          <pre id="workSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <!-- Conics (robust identification + solve) -->
    <section class="section" id="conicSection">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">üåÄ Conic Sections (identify & analyze)</h2>
        <div class="small">General second-degree form: Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0</div>
      </div>

      <div class="io">
        <div class="card" style="flex:1">
          <label class="small">Enter full equation (use x and y)</label>
          <input id="conicExpr" placeholder="e.g. 4x^2 + 0xy + 9y^2 - 36 = 0" style="width:100%" />
          <div class="mt-2">
            <button class="btn" onclick="analyzeConic()">Analyze</button>
            <button class="btn" onclick="conicExample()" style="background:linear-gradient(90deg,var(--p2),var(--p5));margin-left:8px">Example</button>
          </div>
        </div>

        <div style="width:360px" class="card">
          <div><strong>Type</strong></div>
          <div id="conicType" class="mt-2 small">‚Äî</div>
          <hr class="my-2" />
          <div><strong>Steps / notes</strong></div>
          <pre id="conicSteps" class="mt-2 small">‚Äî</pre>
        </div>
      </div>
    </section>

    <footer class="small text-center mt-4">¬© <span id="year"></span> Caffeinated Tutor ‚Äî Syeda Manahil ‚òï</footer>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------- UTIL helpers ----------
    function safeEvalAlgebrite(expr){ // return Algebrite string result (best-effort)
      try{ return Algebrite.run(expr).toString(); }catch(e){ return 'Error: ' + e.message; }
    }
    function renderMathIn(el){ MathJax.typesetPromise([el]); }

    // ---------- DIFFERENTIATION ----------
    function doDifferentiate(){
      const expr = (document.getElementById('diffExpr').value || '').trim();
      if(!expr){ alert('Enter expression'); return; }
      const orderRaw = document.getElementById('diffOrder').value.trim();
      const order = orderRaw ? Math.max(1, parseInt(orderRaw)||1) : 1;
      const at = document.getElementById('diffAt').value.trim();
      try{
        // symbolic differentiate using repeated d()
        let res = expr;
        for(let i=0;i<order;i++){ res = safeEvalAlgebrite('d(' + res + ', x)'); }
        // simplified form
        const simplified = safeEvalAlgebrite('simplify(' + res + ')');
        let answerText = '$' + simplified + '$';
        if(at){
          // evaluate numeric
          const valExpr = simplified + '.subs(x,' + at + ')';
          const numeric = Algebrite.run('eval(' + valExpr + ')');
          answerText += ' , evaluated at x=' + at + ' ‚Üí ' + numeric;
        }
        document.getElementById('diffAnswer').innerHTML = answerText;
        document.getElementById('diffSteps').textContent = 
          `1) Given: ${expr}\n2) Order: ${order}\n3) Repeated differentiation via Algebrite\n4) Raw result: ${res}\n5) Simplified: ${simplified}`;
        renderMathIn(document.getElementById('diffAnswer'));
      }catch(e){ document.getElementById('diffAnswer').textContent = 'Error: '+e.message; }
    }

    // ---------- INTEGRATION ----------
    function doIntegrate(){
      const expr = (document.getElementById('intExpr').value || '').trim();
      if(!expr){ alert('Enter integrand'); return; }
      const a = document.getElementById('intA').value.trim();
      const b = document.getElementById('intB').value.trim();
      try{
        const integral = safeEvalAlgebrite('integral(' + expr + ', x)');
        const simplified = safeEvalAlgebrite('simplify(' + integral + ')');
        let answerText = '$' + simplified + ' + C$';
        let steps = `1) Given: ${expr}\n2) Compute indefinite integral: ${integral}\n3) Simplify: ${simplified}\n4) Add +C for indefinite integrals.`;
        if(a !== '' && b !== ''){
          // definite integral: evaluate by substituting
          const valA = Algebrite.run('eval(' + simplified + '.subs(x,' + a + '))').toString();
          const valB = Algebrite.run('eval(' + simplified + '.subs(x,' + b + '))').toString();
          // Some Algebrite returns symbolic; try numeric if possible
          const numeric = (function(){
            try{ return math.format( math.evaluate(valB) - math.evaluate(valA), {precision:14} ); }catch(e){ return (valB + ' - ' + valA); }
          })();
          answerText = `Definite integral from ${a} to ${b}: ${numeric}`;
          steps += `\n5) Evaluate at upper: ${valB}\n6) Evaluate at lower: ${valA}\n7) Subtract: ${numeric}`;
        }
        document.getElementById('intAnswer').innerHTML = answerText;
        document.getElementById('intSteps').textContent = steps;
        renderMathIn(document.getElementById('intAnswer'));
      }catch(e){ document.getElementById('intAnswer').textContent = 'Error: '+e.message; }
    }

    // ---------- QUADRATIC ----------
    function doQuadratic(){
      let a = document.getElementById('qa').value.trim();
      let b = document.getElementById('qb').value.trim();
      let c = document.getElementById('qc').value.trim();
      const expr = document.getElementById('qexpr').value.trim();
      try{
        if(expr && (!a && !b && !c)){
          // try to parse coefficients from expression using Algebrite
          const poly = safeEvalAlgebrite('expand(' + expr + ')');
          a = parseFloat(Algebrite.run('coeff(' + poly + ', x, 2)')) || 0;
          b = parseFloat(Algebrite.run('coeff(' + poly + ', x, 1)')) || 0;
          c = parseFloat(Algebrite.run('coeff(' + poly + ', x, 0)')) || 0;
        }else{
          a = parseFloat(a) || 0; b = parseFloat(b) || 0; c = parseFloat(c) || 0;
        }
        if(a === 0){ document.getElementById('quadAnswer').textContent = 'Not a quadratic (a=0)'; return; }
        const disc = b*b - 4*a*c;
        let r1, r2;
        if(disc >= 0){
          r1 = (-b + Math.sqrt(disc)) / (2*a);
          r2 = (-b - Math.sqrt(disc)) / (2*a);
        } else {
          // complex roots
          const re = (-b/(2*a)).toFixed(6);
          const im = (Math.sqrt(Math.abs(disc)) / (2*a)).toFixed(6);
          r1 = `${re} + ${im}i`; r2 = `${re} - ${im}i`;
        }
        document.getElementById('quadAnswer').textContent = `Roots: ${r1} , ${r2}`;
        document.getElementById('quadSteps').textContent = `1) coefficients: a=${a}, b=${b}, c=${c}\n2) Discriminant D = b^2 - 4ac = ${disc}\n3) Roots via formula x = (-b ¬± sqrt(D)) / (2a)\n4) Computed roots: ${r1} , ${r2}`;
      }catch(e){ document.getElementById('quadAnswer').textContent = 'Error: '+e.message; }
    }

    // ---------- PARTIAL FRACTIONS ----------
    function doPartial(){
      const expr = (document.getElementById('pfExpr').value || '').trim();
      if(!expr){ alert('Enter rational expression'); return; }
      try{
        const apart = safeEvalAlgebrite('apart(' + expr + ', x)');
        const num = safeEvalAlgebrite('factor(numerator(' + expr + '))');
        const den = safeEvalAlgebrite('factor(denominator(' + expr + '))');
        document.getElementById('pfAnswer').textContent = apart;
        document.getElementById('pfSteps').textContent = `1) Expression: ${expr}\n2) Factor numerator: ${num}\n3) Factor denominator: ${den}\n4) Decompose (apart): ${apart}`;
        renderMathIn(document.getElementById('pfAnswer'));
      }catch(e){ document.getElementById('pfAnswer').textContent='Error: '+e.message; }
    }

    // ---------- GEOMETRY ----------
    const geoShapes = {
      circle: ()=>`<input id="geo_r" placeholder="radius r" class="p-2 border rounded" />`,
      rectangle: ()=>`<input id="geo_l" placeholder="length" class="p-2 border rounded" /> <input id="geo_w" placeholder="width" class="p-2 border rounded" />`,
      square: ()=>`<input id="geo_s" placeholder="side" class="p-2 border rounded" />`,
      triangle: ()=>`<input id="geo_b" placeholder="base" class="p-2 border rounded" /> <input id="geo_h" placeholder="height" class="p-2 border rounded" /> <br/><small class="small">or enter sides a,b,c as: a,b,c in single input geo_triangle_sides</small><br/><input id="geo_triangle_sides" placeholder="e.g. 3,4,5" class="p-2 border rounded" />`,
      trapezoid: ()=>`<input id="geo_a" placeholder="base a" class="p-2 border rounded" /> <input id="geo_b2" placeholder="base b" class="p-2 border rounded" /> <input id="geo_h2" placeholder="height" class="p-2 border rounded" />`,
      parallelogram: ()=>`<input id="geo_base" placeholder="base" class="p-2 border rounded" /> <input id="geo_height" placeholder="height" class="p-2 border rounded" />`,
      ellipse: ()=>`<input id="geo_a2" placeholder="semi-major a" class="p-2 border rounded" /> <input id="geo_b2e" placeholder="semi-minor b" class="p-2 border rounded" />`
    };
    document.getElementById('geoShape').addEventListener('change', updateGeoInputs);
    function updateGeoInputs(){ document.getElementById('geoInputs').innerHTML = geoShapes[document.getElementById('geoShape').value](); }
    updateGeoInputs();

    function fillGeoExample(){
      document.getElementById('geoShape').value='rectangle';
      updateGeoInputs();
      document.getElementById('geo_l').value=5; document.getElementById('geo_w').value=3;
    }

    function computeGeometry(){
      const shape = document.getElementById('geoShape').value;
      let ans='', steps='';
      try{
        if(shape==='circle'){
          const r = parseFloat(document.getElementById('geo_r').value);
          const area = Math.PI * r * r; const per = 2*Math.PI*r;
          ans = `Area = ${area.toFixed(4)}, Circumference = ${per.toFixed(4)}`;
          steps = `Area = œÄ r^2 = œÄ * ${r}^2 = ${area}\nCircumference = 2œÄr = ${per}`;
        } else if(shape==='rectangle'){
          const l = parseFloat(document.getElementById('geo_l').value);
          const w = parseFloat(document.getElementById('geo_w').value);
          const area = l*w; const per = 2*(l+w);
          ans = `Area=${area}, Perimeter=${per}`;
          steps = `Area = l*w = ${l}*${w} = ${area}\nPerimeter = 2(l+w) = ${per}`;
        } else if(shape==='square'){
          const s = parseFloat(document.getElementById('geo_s').value);
          ans = `Area = ${s*s}, Perimeter = ${4*s}`;
          steps = `Area = side^2 = ${s}^2 = ${s*s}\nPerimeter = 4*side = ${4*s}`;
        } else if(shape==='triangle'){
          const sides = (document.getElementById('geo_triangle_sides').value || '').trim();
          if(sides){
            const arr = sides.split(',').map(Number);
            if(arr.length===3){ const [a,b,c]=arr; const s=(a+b+c)/2; const area=Math.sqrt(s*(s-a)*(s-b)*(s-c)); ans=`Area=${area.toFixed(4)}`, steps=`Using Heron's formula: s=${s}, Area = sqrt(s(s-a)(s-b)(s-c)) = ${area}`; }
            else ans='Provide 3 sides as a,b,c';
          } else {
            const base = parseFloat(document.getElementById('geo_b').value);
            const height = parseFloat(document.getElementById('geo_h').value);
            const area = 0.5 * base * height;
            ans = `Area = ${area}`;
            steps = `Area = 1/2 * base * height = 1/2 * ${base} * ${height} = ${area}`;
          }
        } else if(shape==='trapezoid'){
          const a = parseFloat(document.getElementById('geo_a').value);
          const b = parseFloat(document.getElementById('geo_b2').value);
          const h = parseFloat(document.getElementById('geo_h2').value);
          const area = 0.5*(a+b)*h;
          ans = `Area = ${area}`;
          steps = `Area = (a+b)/2 * h = (${a}+${b})/2 * ${h} = ${area}`;
        } else if(shape==='parallelogram'){
          const base = parseFloat(document.getElementById('geo_base').value);
          const h = parseFloat(document.getElementById('geo_height').value);
          const area = base*h;
          ans = `Area = ${area}`;
          steps = `Area = base * height = ${base} * ${h} = ${area}`;
        } else if(shape==='ellipse'){
          const a = parseFloat(document.getElementById('geo_a2').value);
          const b = parseFloat(document.getElementById('geo_b2e').value);
          const area = Math.PI * a * b;
          ans = `Area = ${area.toFixed(4)}`;
          steps = `Area = œÄ a b = œÄ * ${a} * ${b} = ${area}`;
        }
        document.getElementById('geoAnswer').textContent = ans;
        document.getElementById('geoSteps').textContent = steps || '‚Äî';
      }catch(e){ document.getElementById('geoAnswer').textContent = 'Error: '+e.message; }
    }

    // ---------- WORK PROBLEMS ----------
    function workExample(){
      document.getElementById('workText').value = 'A does job in 5 days, B in 10 days. How long together?';
    }

    function solveWork(){
      const text = document.getElementById('workText').value.toLowerCase();
      const ansEl = document.getElementById('workAnswer'); const stepsEl = document.getElementById('workSteps');
      try{
        // simple patterns:
        // "a does job in X days, b in Y days" -> together = 1/(1/X + 1/Y)
        let m = text.match(/a.*?(\d+\.?\d*).*?days.*?b.*?(\d+\.?\d*)/i);
        if(!m) m = text.match(/(\d+\.?\d*).*?days.*?and.*?(\d+\.?\d*).*?days/i);
        if(m){
          const A = parseFloat(m[1]), B = parseFloat(m[2]);
          const rateA = 1/A, rateB = 1/B;
          const together = 1 / (rateA + rateB);
          ansEl.textContent = `${together.toFixed(4)} days`;
          stepsEl.textContent = `Rate A = 1/${A} per day, Rate B = 1/${B} per day\nCombined rate = ${rateA} + ${rateB} = ${(rateA+rateB).toFixed(6)}\nTime = 1 / combined rate = ${together}`;
          return;
        }
        // "A alone in X days; A+B in Y days -> find B"
        m = text.match(/a.*?(\d+\.?\d*).*?days.*?a\+b.*?(\d+\.?\d*).*?days/i);
        if(m){
          const A = parseFloat(m[1]), AB = parseFloat(m[2]);
          const rateA = 1/A;
          const rateAB = 1/AB;
          const rateB = rateAB - rateA;
          const B = 1 / rateB;
          ansEl.textContent = `B takes ${B.toFixed(4)} days alone`;
          stepsEl.textContent = `Rate A = 1/${A}\nRate A+B = 1/${AB}\nRate B = rateAB - rateA = ${rateB}\nSo B = 1/rateB = ${B}`;
          return;
        }
        // "rates given as units/day" -> compute time for particular work
        m = text.match(/a.*?([0-9]+(?:\.[0-9]+)?)\s*units\/day.*?b.*?([0-9]+(?:\.[0-9]+)?)\s*units\/day.*?work\s*([0-9]+(?:\.[0-9]+)?)/i);
        if(m){
          const rA = parseFloat(m[1]), rB = parseFloat(m[2]), work = parseFloat(m[3]);
          const time = work / (rA + rB);
          ansEl.textContent = `${time.toFixed(4)} time units`;
          stepsEl.textContent = `Combined rate = ${rA} + ${rB} = ${rA+rB}\nTime = work / rate = ${work} / ${rA+rB} = ${time}`;
          return;
        }
        // fallback: try to parse like "A in 3 days, B in 6" generically
        m = text.match(/(\d+\.?\d*).*?days.*?(\d+\.?\d*).*?days/);
        if(m){
          const A = parseFloat(m[1]), B = parseFloat(m[2]);
          const together = 1/(1/A + 1/B);
          ansEl.textContent = `${together.toFixed(4)} days`;
          stepsEl.textContent = `Assumed A=${A}, B=${B} days -> combined = ${together}`;
          return;
        }
        ansEl.textContent = 'Unable to parse problem. Try formats: "A does job in X days, B in Y days", or "A alone in X; A+B in Y"';
        stepsEl.textContent = 'Examples supported shown in input placeholder.';
      }catch(e){ ansEl.textContent = 'Error: '+e.message; stepsEl.textContent = ''; }
    }

    // ---------- CONIC ANALYSIS ----------
    function conicExample(){ document.getElementById('conicExpr').value = '4*x^2 + 0*x*y + 9*y^2 - 36 = 0'; }
    function analyzeConic(){
      const expr = (document.getElementById('conicExpr').value || '').trim();
      if(!expr){ alert('Enter general conic equation'); return; }
      // Try to extract coefficients A,B,C,D,E,F for Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0
      try{
        // normalize: replace ^ with ^ for Algebrite and use expand
        const eq = Algebrite.run('expand(' + expr + ')');
        // Algebrite coeffs
        const A = parseFloat(Algebrite.run('coeff(' + eq + ', x, 2)')) || 0;
        const B = parseFloat(Algebrite.run('coeff(' + eq + ', x, 1, y, 1)')) || 0; // attempt b as coeff of xy
        const C = parseFloat(Algebrite.run('coeff(' + eq + ', y, 2)')) || 0;
        // linear terms
        const D = parseFloat(Algebrite.run('coeff(' + eq + ', x, 1)')) || 0;
        const E = parseFloat(Algebrite.run('coeff(' + eq + ', y, 1)')) || 0;
        // constant
        const F = parseFloat(Algebrite.run('coeff(' + eq + ', x, 0)')) || 0;
        // discriminant for conic: B^2 - 4AC
        const disc = B*B - 4*A*C;
        let type = '';
        if(Math.abs(B) < 1e-9 && Math.abs(A - C) < 1e-9 && A !== 0) type = 'Circle (A=C, B=0)';
        else if(disc < 0) type = 'Ellipse (or circle if A=C)';
        else if(disc === 0) type = 'Parabola';
        else if(disc > 0) type = 'Hyperbola';
        const steps = `Extracted coefficients: A=${A}, B=${B}, C=${C}, D=${D}, E=${E}, F=${F}\nDiscriminant (B^2 - 4AC) = ${disc}\nConic type based on sign of discriminant.`;
        document.getElementById('conicType').textContent = type;
        document.getElementById('conicSteps').textContent = steps;
      }catch(e){ document.getElementById('conicType').textContent = 'Error: '+e.message; document.getElementById('conicSteps').textContent=''; }
    }

    // ---------- EXTRA: attach change listeners for nice UX ----------
    // (already added for geo select)

    // ---------- finishing ----------
    // initial setup
    updateGeoInputs();
  </script>
</body>
</html>